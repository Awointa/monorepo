openapi: 3.0.3
info:
  title: ShelterFlex Backend API
  description: API for ShelterFlex backend service
  version: 0.1.0
  contact:
    name: ShelterFlex Team
  license:
    name: MIT

servers:
  - url: http://localhost:4000
    description: Development server
  - url: https://api.shelterflex.io
    description: Production server

paths:
  /health:
    get:
      summary: Health check endpoint
      description: Returns the current health status and basic service information
      operationId: getHealth
      tags:
        - Health
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                required:
                  - status
                  - version
                  - uptimeSeconds
                properties:
                  status:
                    type: string
                    enum: [ok]
                    example: ok
                  version:
                    type: string
                    example: "0.1.0"
                  uptimeSeconds:
                    type: number
                    format: int64
                    example: 3600
        '429':
          $ref: '#/components/responses/TooManyRequests'
        default:
          $ref: '#/components/responses/Error'

  /soroban/config:
    get:
      summary: Get Soroban configuration
      description: Returns the current Soroban blockchain configuration
      operationId: getSorobanConfig
      tags:
        - Soroban
      responses:
        '200':
          description: Soroban configuration retrieved successfully
          content:
            application/json:
              schema:
                type: object
                required:
                  - rpcUrl
                  - networkPassphrase
                  - contractId
                properties:
                  rpcUrl:
                    type: string
                    format: uri
                    example: "https://soroban-testnet.stellar.org"
                  networkPassphrase:
                    type: string
                    example: "Test SDF Network ; September 2015"
                  contractId:
                    type: string
                    nullable: true
                    example: null
        '429':
          $ref: '#/components/responses/TooManyRequests'
        default:
          $ref: '#/components/responses/Error'

  /api/whistleblower/listings:
    post:
      summary: Create a new listing
      description: |
        Create a new property listing. 
        
        Rules:
        - Address is required
        - Annual rent must be greater than 0
        - At least 3 photos are required
        - Maximum 2 listings per whistleblower per month
      operationId: createListing
      tags:
        - Whistleblower
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateListingRequest'
      responses:
        '201':
          description: Listing created successfully
          content:
            application/json:
              schema:
                type: object
                required:
                  - success
                  - listing
                properties:
                  success:
                    type: boolean
                    example: true
                  listing:
                    $ref: '#/components/schemas/Listing'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missingPhotos:
                  summary: Missing required photos
                  value:
                    error:
                      code: VALIDATION_ERROR
                      message: Invalid request data
                      details:
                        fields:
                          - field: photos
                            message: At least 3 photos are required
                invalidRent:
                  summary: Invalid annual rent
                  value:
                    error:
                      code: VALIDATION_ERROR
                      message: Invalid request data
                      details:
                        fields:
                          - field: annualRentNgn
                            message: Annual rent must be greater than 0
        '429':
          description: Monthly limit reached
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error:
                  code: CONFLICT
                  message: Monthly listing limit reached
                  details:
                    currentCount: 2
                    maxAllowed: 2
                    message: You have reached the maximum of 2 listings per month
        default:
          $ref: '#/components/responses/Error'
    
    get:
      summary: List listings
      description: Get a paginated list of listings with optional filters
      operationId: listListings
      tags:
        - Whistleblower
      parameters:
        - name: status
          in: query
          description: Filter by listing status
          required: false
          schema:
            $ref: '#/components/schemas/ListingStatus'
        - name: query
          in: query
          description: Search term for address, city, area, or description
          required: false
          schema:
            type: string
            example: Lagos
        - name: page
          in: query
          description: Page number
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
            example: 1
        - name: pageSize
          in: query
          description: Number of items per page
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
            example: 20
      responses:
        '200':
          description: Listings retrieved successfully
          content:
            application/json:
              schema:
                type: object
                required:
                  - success
                  - listings
                  - pagination
                properties:
                  success:
                    type: boolean
                    example: true
                  listings:
                    type: array
                    items:
                      $ref: '#/components/schemas/Listing'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '400':
          $ref: '#/components/responses/Error'
        default:
          $ref: '#/components/responses/Error'

  /api/whistleblower/listings/{id}:
    get:
      summary: Get listing by ID
      description: Retrieve a single listing by its ID
      operationId: getListingById
      tags:
        - Whistleblower
      parameters:
        - name: id
          in: path
          description: Listing ID
          required: true
          schema:
            type: string
            format: uuid
            example: 550e8400-e29b-41d4-a716-446655440000
      responses:
        '200':
          description: Listing retrieved successfully
          content:
            application/json:
              schema:
                type: object
                required:
                  - success
                  - listing
                properties:
                  success:
                    type: boolean
                    example: true
                  listing:
                    $ref: '#/components/schemas/Listing'
        '404':
          description: Listing not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error:
                  code: NOT_FOUND
                  message: Listing with ID '550e8400-e29b-41d4-a716-446655440000' not found
        default:
          $ref: '#/components/responses/Error'

  /api/payments/confirm:
    post:
      summary: Confirm a payment and write a USDC receipt on-chain
      description: |
        Confirm an off-chain (bank/card/PSP) or on-chain (Stellar) payment and record an
        idempotent USDC receipt on the Soroban ledger.

        **USDC is the canonical accounting unit.** All on-chain receipts are denominated in USDC.
        NGN amounts and FX metadata are optional and stored as off-chain metadata only.

        **Idempotency:** Submitting the same `(externalRefSource, externalRef)` pair twice will
        return the existing receipt without writing a duplicate on-chain.
      operationId: confirmPayment
      tags:
        - Payments
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConfirmPaymentRequest'
            examples:
              tenantRepayment:
                summary: Tenant repayment via Stripe
                value:
                  dealId: "550e8400-e29b-41d4-a716-446655440000"
                  txType: tenant_repayment
                  amountUsdc: "64.52"
                  tokenAddress: "GBBD47IF6LWK7P7MDEVSCWR7DPUWV3NY3DTQEVFL4NAT4AQH3ZLLFLA5"
                  externalRefSource: stripe
                  externalRef: pi_3OZxyz123456
                  amountNgn: 100000
                  fxRateNgnPerUsdc: 1550.00
                  fxProvider: exchangerate-api
              landlordPayout:
                summary: Landlord payout
                value:
                  dealId: "550e8400-e29b-41d4-a716-446655440000"
                  txType: landlord_payout
                  amountUsdc: "774.19"
                  tokenAddress: "GBBD47IF6LWK7P7MDEVSCWR7DPUWV3NY3DTQEVFL4NAT4AQH3ZLLFLA5"
                  externalRefSource: stellar
                  externalRef: "a3f2c1d4e5b6..."
      responses:
        '200':
          description: Payment confirmed and USDC receipt written to chain
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentConfirmationResponse'
              example:
                success: true
                outboxId: "550e8400-e29b-41d4-a716-446655440001"
                txId: "a3f2c1d4e5b6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2"
                status: sent
                message: "Payment confirmed and USDC receipt written to chain"
        '202':
          description: Payment confirmed, USDC receipt queued for retry
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentConfirmationResponse'
              example:
                success: true
                outboxId: "550e8400-e29b-41d4-a716-446655440001"
                txId: "a3f2c1d4e5b6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2"
                status: failed
                message: "Payment confirmed, USDC receipt queued for retry"
        '400':
          $ref: '#/components/responses/Error'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        default:
          $ref: '#/components/responses/Error'

  /api/deals:
    post:
      summary: Create a new deal with repayment schedule
      description: Creates a new financing deal with a deterministic repayment schedule
      operationId: createDeal
      tags:
        - Deals
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDealRequest'
      responses:
        '201':
          description: Deal created successfully
          content:
            application/json:
              schema:
                type: object
                required:
                  - success
                  - data
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/DealWithSchedule'
        '400':
          $ref: '#/components/responses/Error'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        default:
          $ref: '#/components/responses/Error'

    get:
      summary: Get deals with optional filtering
      description: Retrieves a paginated list of deals, optionally filtered by tenant, landlord, or status
      operationId: getDeals
      tags:
        - Deals
      parameters:
        - name: tenantId
          in: query
          description: Filter by tenant ID
          schema:
            type: string
        - name: landlordId
          in: query
          description: Filter by landlord ID
          schema:
            type: string
        - name: status
          in: query
          description: Filter by deal status
          schema:
            $ref: '#/components/schemas/DealStatus'
        - name: page
          in: query
          description: Page number for pagination
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: pageSize
          in: query
          description: Number of items per page
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: Deals retrieved successfully
          content:
            application/json:
              schema:
                type: object
                required:
                  - success
                  - data
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/PaginatedDeals'
        '400':
          $ref: '#/components/responses/Error'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        default:
          $ref: '#/components/responses/Error'

  /api/deals/{dealId}:
    get:
      summary: Get a specific deal by ID with schedule
      description: Retrieves a single deal including its full repayment schedule
      operationId: getDealById
      tags:
        - Deals
      parameters:
        - name: dealId
          in: path
          required: true
          description: ID of the deal to retrieve
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Deal retrieved successfully
          content:
            application/json:
              schema:
                type: object
                required:
                  - success
                  - data
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/DealWithSchedule'
        '404':
          $ref: '#/components/responses/Error'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        default:
          $ref: '#/components/responses/Error'

  /api/deals/{dealId}/status:
    patch:
      summary: Update deal status
      description: Updates the status of a deal (e.g., from draft to active)
      operationId: updateDealStatus
      tags:
        - Deals
      parameters:
        - name: dealId
          in: path
          required: true
          description: ID of the deal to update
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateDealStatusRequest'
      responses:
        '200':
          description: Deal status updated successfully
          content:
            application/json:
              schema:
                type: object
                required:
                  - success
                  - data
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/DealWithSchedule'
        '400':
          $ref: '#/components/responses/Error'
        '404':
          $ref: '#/components/responses/Error'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        default:
          $ref: '#/components/responses/Error'

  /api/deals/{dealId}/schedule/{period}:
    patch:
      summary: Update schedule item status
      description: Updates the status of a specific repayment schedule item
      operationId: updateScheduleItemStatus
      tags:
        - Deals
      parameters:
        - name: dealId
          in: path
          required: true
          description: ID of the deal
          schema:
            type: string
            format: uuid
        - name: period
          in: path
          required: true
          description: Period number in the repayment schedule
          schema:
            type: integer
            minimum: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateScheduleItemRequest'
      responses:
        '200':
          description: Schedule item status updated successfully
          content:
            application/json:
              schema:
                type: object
                required:
                  - success
                  - data
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/DealWithSchedule'
        '400':
          $ref: '#/components/responses/Error'
        '404':
          $ref: '#/components/responses/Error'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        default:
          $ref: '#/components/responses/Error'

  /api/admin/rewards/{rewardId}/mark-paid:
    post:
      summary: Mark reward as paid
      description: |
        Mark a whistleblower reward as paid and record receipt on-chain.
        
        Rules:
        - Reward must be in 'payable' status
        - Creates on-chain receipt with WHISTLEBLOWER_REWARD type
        - Idempotent by external reference (duplicate refs return same txId)
        - Receipt contains dealId and listingId
      operationId: markRewardPaid
      tags:
        - Admin
      parameters:
        - name: rewardId
          in: path
          description: Reward ID
          required: true
          schema:
            type: string
            format: uuid
            example: 550e8400-e29b-41d4-a716-446655440000
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MarkRewardPaidRequest'
      responses:
        '200':
          description: Reward marked as paid and receipt written to chain
          content:
            application/json:
              schema:
                type: object
                required:
                  - success
                  - reward
                  - receipt
                  - message
                properties:
                  success:
                    type: boolean
                    example: true
                  reward:
                    type: object
                    required:
                      - rewardId
                      - status
                    properties:
                      rewardId:
                        type: string
                        format: uuid
                      status:
                        type: string
                        enum: [paid]
                      paidAt:
                        type: string
                        format: date-time
                      paymentTxId:
                        type: string
                        description: Transaction ID on blockchain
                  receipt:
                    type: object
                    required:
                      - outboxId
                      - txId
                      - status
                    properties:
                      outboxId:
                        type: string
                        format: uuid
                      txId:
                        type: string
                        description: 32-byte transaction ID as hex
                      status:
                        type: string
                        enum: [pending, sent, failed]
                  message:
                    type: string
                    example: Reward marked as paid and receipt written to chain
        '202':
          description: Reward marked as paid, receipt queued for retry
          content:
            application/json:
              schema:
                type: object
                required:
                  - success
                  - reward
                  - receipt
                  - message
                properties:
                  success:
                    type: boolean
                    example: true
                  reward:
                    type: object
                  receipt:
                    type: object
                  message:
                    type: string
                    example: Reward marked as paid, receipt queued for retry
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Reward not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error:
                  code: NOT_FOUND
                  message: Reward with ID '550e8400-e29b-41d4-a716-446655440000' not found
        '409':
          description: Reward not in payable status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error:
                  code: CONFLICT
                  message: Reward cannot be marked as paid. Current status pending
                  details:
                    currentStatus: pending
                    requiredStatus: payable
        default:
          $ref: '#/components/responses/Error'

components:
  schemas:
    PaymentTxType:
      type: string
      enum:
        - tenant_repayment
        - landlord_payout
        - whistleblower_reward
      description: |
        Transaction type for the on-chain USDC receipt.
        - `tenant_repayment` — tenant repaying ShelterFlex financing
        - `landlord_payout` — ShelterFlex paying landlord upfront
        - `whistleblower_reward` — reward paid to a whistleblower

    ConfirmPaymentRequest:
      type: object
      description: |
        Request body for confirming a payment. **USDC is the canonical unit** for all
        on-chain receipts. NGN values (`amountNgn`, `fxRateNgnPerUsdc`, `fxProvider`) are
        optional metadata and are NOT stored on-chain.
      required:
        - dealId
        - txType
        - amountUsdc
        - tokenAddress
        - externalRefSource
        - externalRef
      properties:
        dealId:
          type: string
          description: ID of the deal this payment is associated with
          example: "550e8400-e29b-41d4-a716-446655440000"
        txType:
          $ref: '#/components/schemas/PaymentTxType'
        amountUsdc:
          type: string
          description: |
            Payment amount in USDC (canonical on-chain unit). Decimal string with up to 6 places.
          pattern: '^\d+(\.\d{1,6})?$'
          example: "64.52"
        tokenAddress:
          type: string
          description: USDC token contract address on Stellar
          example: "GBBD47IF6LWK7P7MDEVSCWR7DPUWV3NY3DTQEVFL4NAT4AQH3ZLLFLA5"
        externalRefSource:
          type: string
          description: Payment provider identifier (e.g., stripe, manual, stellar, flutterwave)
          pattern: '^[a-zA-Z0-9_-]+$'
          example: stripe
        externalRef:
          type: string
          description: Provider-specific payment reference string (e.g., charge ID, transaction hash)
          example: pi_3OZxyz123456
        amountNgn:
          type: number
          description: Payment amount in NGN (optional metadata, not stored on-chain)
          example: 100000
        fxRateNgnPerUsdc:
          type: number
          description: FX rate (NGN per 1 USDC) at time of payment (optional metadata)
          example: 1550.00
        fxProvider:
          type: string
          description: FX rate provider name (optional metadata)
          example: exchangerate-api

    PaymentConfirmationResponse:
      type: object
      required:
        - success
        - outboxId
        - txId
        - status
        - message
      properties:
        success:
          type: boolean
          example: true
        outboxId:
          type: string
          format: uuid
          description: Internal outbox item ID
          example: "550e8400-e29b-41d4-a716-446655440001"
        txId:
          type: string
          description: Deterministic SHA-256 transaction ID (BytesN<32> as hex). Same (externalRefSource, externalRef) always yields the same txId.
          example: "a3f2c1d4e5b6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2"
        status:
          type: string
          enum: [pending, sent, failed]
          example: sent
        message:
          type: string
          example: "Payment confirmed and USDC receipt written to chain"

    ListingStatus:
      type: string
      enum:
        - pending_review
        - approved
        - rejected
        - rented
      example: pending_review

    CreateListingRequest:
      type: object
      required:
        - whistleblowerId
        - address
        - bedrooms
        - bathrooms
        - annualRentNgn
        - photos
      properties:
        whistleblowerId:
          type: string
          description: ID of the whistleblower creating the listing
          example: wb-001
        address:
          type: string
          description: Full address of the property
          minLength: 1
          example: 123 Main Street, Ikeja, Lagos
        city:
          type: string
          description: City where the property is located
          example: Lagos
        area:
          type: string
          description: Specific area or neighborhood
          example: Ikeja
        bedrooms:
          type: integer
          description: Number of bedrooms
          minimum: 0
          example: 2
        bathrooms:
          type: integer
          description: Number of bathrooms
          minimum: 0
          example: 2
        annualRentNgn:
          type: integer
          description: Annual rent in Nigerian Naira
          minimum: 1
          example: 1200000
        description:
          type: string
          description: Optional description of the property
          example: Beautiful 2-bedroom apartment with modern amenities
        photos:
          type: array
          description: Array of photo URLs (minimum 3, maximum 20)
          minItems: 3
          maxItems: 20
          items:
            type: string
            format: uri
            example: https://example.com/photo1.jpg

    Listing:
      type: object
      required:
        - listingId
        - whistleblowerId
        - address
        - bedrooms
        - bathrooms
        - annualRentNgn
        - photos
        - status
        - createdAt
        - updatedAt
      properties:
        listingId:
          type: string
          format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000
        whistleblowerId:
          type: string
          example: wb-001
        address:
          type: string
          example: 123 Main Street, Ikeja, Lagos
        city:
          type: string
          nullable: true
          example: Lagos
        area:
          type: string
          nullable: true
          example: Ikeja
        bedrooms:
          type: integer
          example: 2
        bathrooms:
          type: integer
          example: 2
        annualRentNgn:
          type: integer
          example: 1200000
        description:
          type: string
          nullable: true
          example: Beautiful 2-bedroom apartment
        photos:
          type: array
          items:
            type: string
            format: uri
          example:
            - https://example.com/photo1.jpg
            - https://example.com/photo2.jpg
            - https://example.com/photo3.jpg
        status:
          $ref: '#/components/schemas/ListingStatus'
        createdAt:
          type: string
          format: date-time
          example: 2024-01-15T10:00:00Z
        updatedAt:
          type: string
          format: date-time
          example: 2024-01-15T10:00:00Z
        rejectionReason:
          type: string
          nullable: true
          description: Reason for rejection (only present if status is rejected)
          example: Insufficient photo quality

    DealStatus:
      type: string
      enum:
        - draft
        - active
        - completed
        - defaulted
      example: draft

    ScheduleItemStatus:
      type: string
      enum:
        - upcoming
        - due
        - paid
        - late
      example: upcoming

    ScheduleItem:
      type: object
      required:
        - period
        - dueDate
        - amountNgn
        - status
      properties:
        period:
          type: integer
          description: Period number in the repayment schedule (1-indexed)
          example: 1
        dueDate:
          type: string
          format: date-time
          description: ISO date when payment is due
          example: 2024-02-15T00:00:00Z
        amountNgn:
          type: number
          format: double
          description: Payment amount in Nigerian Naira
          example: 83333.33
        status:
          $ref: '#/components/schemas/ScheduleItemStatus'

    Deal:
      type: object
      required:
        - dealId
        - tenantId
        - landlordId
        - annualRentNgn
        - depositNgn
        - financedAmountNgn
        - termMonths
        - createdAt
        - status
      properties:
        dealId:
          type: string
          format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000
        tenantId:
          type: string
          description: ID of the tenant repaying the financing
          example: tenant-001
        landlordId:
          type: string
          description: ID of the landlord who received upfront payment
          example: landlord-001
        listingId:
          type: string
          format: uuid
          nullable: true
          description: Optional ID of the associated property listing
          example: 550e8400-e29b-41d4-a716-446655440001
        annualRentNgn:
          type: integer
          description: Annual rent amount in Naira
          example: 1200000
        depositNgn:
          type: integer
          description: Deposit amount paid by tenant (must be >= 20% of annual rent)
          example: 240000
        financedAmountNgn:
          type: integer
          description: Amount financed by ShelterFlex (annual rent - deposit)
          example: 960000
        termMonths:
          type: integer
          description: Repayment term in months (3, 6, or 12)
          example: 12
        createdAt:
          type: string
          format: date-time
          example: 2024-01-15T10:00:00Z
        status:
          $ref: '#/components/schemas/DealStatus'

    DealWithSchedule:
      type: object
      required:
        - dealId
        - tenantId
        - landlordId
        - annualRentNgn
        - depositNgn
        - financedAmountNgn
        - termMonths
        - createdAt
        - status
        - schedule
      properties:
        dealId:
          type: string
          format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000
        tenantId:
          type: string
          example: tenant-001
        landlordId:
          type: string
          example: landlord-001
        listingId:
          type: string
          format: uuid
          nullable: true
          example: 550e8400-e29b-41d4-a716-446655440001
        annualRentNgn:
          type: integer
          example: 1200000
        depositNgn:
          type: integer
          example: 240000
        financedAmountNgn:
          type: integer
          example: 960000
        termMonths:
          type: integer
          example: 12
        createdAt:
          type: string
          format: date-time
          example: 2024-01-15T10:00:00Z
        status:
          $ref: '#/components/schemas/DealStatus'
        schedule:
          type: array
          items:
            $ref: '#/components/schemas/ScheduleItem'

    CreateDealRequest:
      type: object
      required:
        - tenantId
        - landlordId
        - annualRentNgn
        - depositNgn
        - termMonths
      properties:
        tenantId:
          type: string
          description: ID of the tenant who will repay the financing
          example: tenant-001
        landlordId:
          type: string
          description: ID of the landlord who will receive upfront payment
          example: landlord-001
        listingId:
          type: string
          format: uuid
          nullable: true
          description: Optional ID of the associated property listing
          example: 550e8400-e29b-41d4-a716-446655440001
        annualRentNgn:
          type: integer
          description: Annual rent amount in Naira
          example: 1200000
        depositNgn:
          type: integer
          description: Deposit amount paid by tenant (must be >= 20% of annual rent)
          example: 240000
        termMonths:
          type: integer
          description: Repayment term in months (must be 3, 6, or 12)
          example: 12

    UpdateDealStatusRequest:
      type: object
      required:
        - status
      properties:
        status:
          $ref: '#/components/schemas/DealStatus'

    UpdateScheduleItemRequest:
      type: object
      required:
        - status
      properties:
        status:
          $ref: '#/components/schemas/ScheduleItemStatus'

    PaginatedDeals:
      type: object
      required:
        - deals
        - total
        - page
        - pageSize
        - totalPages
      properties:
        deals:
          type: array
          items:
            $ref: '#/components/schemas/Deal'
        total:
          type: integer
          description: Total number of deals matching the filter
          example: 42
        page:
          type: integer
          description: Current page number
          example: 1
        pageSize:
          type: integer
          description: Number of deals per page
          example: 20
        totalPages:
          type: integer
          description: Total number of pages
          example: 3

    Pagination:
      type: object
      required:
        - total
        - page
        - pageSize
        - totalPages
      properties:
        total:
          type: integer
          description: Total number of items
          example: 42
        page:
          type: integer
          description: Current page number
          example: 1
        pageSize:
          type: integer
          description: Number of items per page
          example: 20
        totalPages:
          type: integer
          description: Total number of pages
          example: 3

    MarkRewardPaidRequest:
      type: object
      required:
        - amountUsdc
        - tokenAddress
        - externalRefSource
        - externalRef
      properties:
        amountUsdc:
          type: number
          description: Payment amount in USDC
          minimum: 0.01
          example: 100
        tokenAddress:
          type: string
          description: USDC token contract address
          example: USDC_CONTRACT_ADDRESS
        externalRefSource:
          type: string
          description: Source of external reference (e.g., "stripe", "manual")
          example: stripe
        externalRef:
          type: string
          description: External payment reference ID
          example: pi_abc123
        amountNgn:
          type: number
          description: Optional payment amount in Nigerian Naira
          example: 150000
        fxRateNgnPerUsdc:
          type: number
          description: Optional FX rate (NGN per USDC)
          example: 1500
        fxProvider:
          type: string
          description: Optional FX rate provider
          example: coinbase

    Error:
      type: object
      required:
        - error
      properties:
        error:
          type: object
          required:
            - code
            - message
          properties:
            code:
              type: string
              enum:
                - VALIDATION_ERROR
                - UNAUTHORIZED
                - FORBIDDEN
                - NOT_FOUND
                - CONFLICT
                - SOROBAN_ERROR
                - INTERNAL_ERROR
              example: NOT_FOUND
            message:
              type: string
              example: "Resource not found"
            details:
              type: object
              description: Optional structured context for the error
              additionalProperties: true

  responses:
    Error:
      description: Unexpected error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    
    TooManyRequests:
      description: Rate limit exceeded
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              code: "TOO_MANY_REQUESTS"
              message: "Rate limit exceeded"

  securitySchemes: {}

tags:
  - name: Health
    description: Health check operations
  - name: Soroban
    description: Soroban blockchain configuration
  - name: Payments
    description: Payment confirmation and on-chain USDC receipt recording
  - name: Whistleblower
    description: Whistleblower listing operations
  - name: Deals
    description: Deal management and repayment schedule operations
  - name: Admin
    description: Administrative operations including reward payouts
